Fortran v3 example suite status
===============================

This page tracks the vendored upstream SFINCS Fortran v3 example suite
(``examples/sfincs_examples``) from the perspective of **end-to-end output parity**.

For each upstream example input we report:

1. whether ``sfincs_jax`` successfully writes ``sfincsOutput.h5`` for that exact input,
2. whether that exact input has a frozen Fortran output fixture in-repo and matches it,
3. and the reason when parity is not currently verified.

How this table is generated
---------------------------

The table is generated by:

.. code-block:: bash

   python scripts/generate_fortran_example_output_status.py

Generation logic:

- Runs ``sfincs_jax write-output`` semantics for each upstream example input.
- Matches each input against ``tests/ref/*.input.namelist`` by exact file content.
- If a matching frozen ``tests/ref/*.sfincsOutput.h5`` exists, compares datasets with
  ``compare_sfincs_outputs``.
- Otherwise marks the case as ``unverified`` with a concrete reason.

.. note::

   In this repository snapshot, most upstream examples are marked ``unverified`` because
   there is no exact-matching frozen Fortran ``sfincsOutput.h5`` fixture for that specific
   input file. This is different from ``unsupported``: many of those cases do run and write
   output with ``sfincs_jax``.

Output parity table
-------------------

.. include:: _generated/fortran_examples_output_status.rst

Complementary audit
-------------------

A broader capability audit (grid/geometry/write-output support classification) is also
maintained and auto-generated:

.. code-block:: bash

   python scripts/generate_fortran_example_audit.py

.. include:: _generated/fortran_examples_table.rst

Reduced-runtime parity sweep (case-by-case)
-------------------------------------------

For rapid parity iteration, we also keep a reduced-resolution sweep generated with:

.. code-block:: bash

   python scripts/run_reduced_upstream_suite.py --timeout-s 30 --max-attempts 8

This workflow:

1. copies each upstream input into ``tests/reduced_upstream_examples/<case>/input.namelist``,
2. halves resolution axes adaptively until both Fortran and ``sfincs_jax`` runs are under 30s,
3. compares resulting ``sfincsOutput.h5`` files.

The latest generated table is:

.. include:: _generated/reduced_upstream_suite_status.rst

First completed reduced-resolution parity case
----------------------------------------------

- Case: ``HSX_FPCollisions_DKESTrajectories``
- Saved reduced input: ``tests/reduced_inputs/HSX_FPCollisions_DKESTrajectories.input.namelist``
- Final reduced resolution used for parity: ``NTHETA=6, NZETA=15, NX=3, NXI=10``
- Runtime with this reduced input (current local run): Fortran ``0.51 s``, ``sfincs_jax`` ``1.38 s``
- HDF5 parity status: ``parity_ok`` at ``rtol=1e-8``, ``atol=1e-8`` over common numeric datasets.

Notes:

- The adaptive runner enforces ``<30 s`` per run attempt and halves the largest grid axis when a run
  times out or fails.
- This case is now reusable as a fast parity step before moving to the next upstream example.
